# Reusable workflow for core team Claude PR review.
# Called by claude-coreteam-review.yml with user-specific OAuth tokens.
name: Claude Core Team Review (Shared)

on:
  workflow_call:
    inputs:
      pr_number:
        required: true
        type: number
    secrets:
      CLAUDE_CODE_OAUTH_TOKEN:
        required: true

jobs:
  pr-review:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    permissions:
      contents: read
      pull-requests: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
        with:
          fetch-depth: 1
          persist-credentials: false

      - name: Setup environment
        uses: ./.github/actions/setup-env

      - name: PR Review with Claude
        uses: ./.github/actions/run-claude
        with:
          prompt: "/review-pr REPO: ${{ github.repository }} PR_NUMBER: ${{ inputs.pr_number }}"
          allowed_tools: "Read,Bash(gh pr comment:*),Bash(gh pr diff:*),Bash(gh pr view:*)"
          claude_code_oauth_token: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          use_sticky_comment: "true"
          track_progress: "true"
